<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>日本3日上網卡 - 带条形码版</title>
<style id="card-styles">
    :root {
        --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        --border-color: #eee;
        --text-color-primary: #333;
        --text-color-secondary: #555;
        --pink-dark: #F06292;
        --pink-medium: #EC407A;
        --pink-light: #F8BBD0;
        --red-notice: #E57373;
        --editable-focus-color: #007BFF;
        --button-bg-color: #007bff;
        --button-hover-bg-color: #0056b3;
    }

    body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background-color: #f0f2f5;
        font-family: var(--font-family);
        margin: 0;
        padding: 40px 20px;
        box-sizing: border-box;
    }

    #export-button {
        padding: 12px 25px;
        font-size: 16px;
        font-weight: bold;
        color: white;
        background-color: var(--button-bg-color);
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin-bottom: 30px;
        transition: background-color 0.3s, transform 0.1s;
    }
    #export-button:hover { background-color: var(--button-hover-bg-color); }
    #export-button:active { transform: scale(0.98); }

    .card-container {
        display: flex;
        width: 1000px;
        height: 714px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        background-color: #fff;
        border-radius: 20px;
        overflow: hidden;
    }

    /* --- Editable Fields Style --- */
    [contenteditable="true"] {
        cursor: pointer; padding: 2px 4px; border-radius: 3px;
        transition: background-color 0.2s, box-shadow 0.2s; }
    [contenteditable="true"]:hover { background-color: rgba(0, 0, 0, 0.05); }
    [contenteditable="true"]:focus {
        background-color: #fff; color: #000;
        outline: 1px solid var(--editable-focus-color);
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2); }
    .top-section [contenteditable="true"]:focus { background-color: rgba(255,255,255,0.9); }
    .main-content [contenteditable="true"]:focus { background-color: rgba(255,255,255,0.7); }

    /* --- Panel Structure --- */
    .left-panel, .right-panel {
        width: 500px;
        height: 714px;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
    }

    .left-panel {
        padding: 25px;
        border-right: 1px dashed #ccc;
    }

    .right-panel {
        padding: 0;
        overflow: hidden;
    }

    /* --- 条形码区域 --- */
    .barcode-section {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
    }

    .barcode-area {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }

    .barcode-placeholder {
        width: 180px;
        height: 40px;
        border: 1px dashed #999;
        background: repeating-linear-gradient(
            90deg,
            #000 0px,
            #000 1px,
            #fff 1px,
            #fff 2px,
            #000 2px,
            #000 3px,
            #fff 3px,
            #fff 5px
        );
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        color: #666;
        margin-bottom: 5px;
        border-radius: 2px;
    }

    .barcode-number {
        font-family: 'Courier New', monospace;
        font-size: 10px;
        color: var(--text-color-primary);
        letter-spacing: 1px;
        padding: 2px 4px;
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 2px;
        min-width: 120px;
        text-align: center;
    }

    .barcode-number:focus {
        background-color: #fff;
        border-color: var(--editable-focus-color);
    }

    /* --- 左侧面板布局 --- */
    .left-content {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .contact-info {
        display: flex;
        justify-content: space-between;
        font-size: 10px;
        color: var(--text-color-primary);
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 20px;
    }
    .contact-info .col {
        display: flex;
        flex-direction: column;
        line-height: 1.4;
        padding: 0 3px;
        flex: 1;
    }
    .contact-info .col span:first-child { font-weight: bold; }

    .sim-cutouts {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        flex-grow: 1;
        margin-bottom: 20px;
    }

    .sim-nano-container {
        width: 70px;
        height: 90px;
        border: 1px dashed var(--red-notice);
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 4px;
        color: var(--red-notice);
        font-size: 12px;
    }

    .sim-main-shape {
        width: 120px;
        height: 180px;
        border: 2px solid var(--text-color-primary);
        border-radius: 8px;
    }

    .terms-section {
        font-size: 8.5px;
        color: var(--text-color-secondary);
        line-height: 1.5;
        border-top: 1px solid var(--border-color);
        padding-top: 12px;
        max-height: 160px;
        overflow-y: auto;
    }
    .terms-section .final-interpretation {
        color: var(--red-notice);
        text-align: center;
        margin-bottom: 10px;
        font-size: 7.5px;
    }
    .terms-section p {
        margin: 8px 0;
        word-break: break-word;
    }
    .terms-section [contenteditable]:focus { background-color: #f9f9f9; }

    /* --- Right Panel --- */
    .top-section {
        background-color: var(--pink-dark);
        padding: 20px 25px 35px;
        color: white;
        position: relative;
        height: 250px;
        box-sizing: border-box;
    }

    .brand-info {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        height: 35px;
        position: relative;
        font-size: 16px;
        font-weight: 500;
    }
    .network-badge-placeholder {
        position: absolute;
        top: 0px;
        right: 120px;
        background-color: #FFEB3B;
        color: #E53935;
        font-weight: bold;
        border-radius: 50%;
        width: 35px;
        height: 35px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 9px;
        line-height: 1;
    }
    .network-badge-placeholder hr {
        width: 80%;
        margin: 1px 0;
        border: 0;
        border-top: 1px solid #E53935;
    }
    .network-badge-placeholder [contenteditable] { padding: 0; }

    .product-title {
        display: flex;
        align-items: baseline;
        font-weight: bold;
        white-space: nowrap;
        margin-top: 8px;
        font-size: 60px;
    }
    .product-title .days {
        font-size: 44px;
        margin: 0 8px;
    }

    .product-subtitle {
        font-size: 20px;
        color: white;
        margin-top: 6px;
        font-weight: 500;
    }

    .price {
        position: absolute;
        right: 25px;
        bottom: -18px;
        background-color: var(--pink-medium);
        padding: 5px 22px;
        font-size: 28px;
        font-weight: bold;
        border-radius: 8px;
        color: white;
    }

    .main-content {
        padding: 40px 30px 25px;
        background-color: var(--pink-light);
        height: calc(714px - 250px);
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
    }

    .bubble {
        display: flex;
        align-items: center;
        background-color: var(--pink-dark);
        color: white;
        padding: 8px 20px;
        border-radius: 35px;
        margin-bottom: 20px;
        width: fit-content;
    }
    .bubble .main-text {
        font-weight: bold;
        font-size: 34px;
        flex-shrink: 0;
        margin-right: 12px;
    }
    .bubble .subtext {
        font-size: 10px;
        line-height: 1.3;
        font-weight: 500;
    }
    .bubble.validity .main-text { font-size: 34px; }
    .bubble.validity .subtext {
        font-size: 13px;
        font-weight: 500;
        margin-left: 8px;
    }

    /* --- 新增高亮样式 --- */
    .highlight-changes {
        background-color: #ffeb3b !important;
        border-radius: 2px;
        padding: 1px 3px;
    }
</style>
</head>
<body>

<button id="export-button">导出为 HTML（高亮修改内容）</button>

<div class="card-container" id="card-to-export">
    <div class="left-panel">
        <div class="left-content">
            <!-- 条形码区域 -->
            <div class="barcode-section">
                <div class="barcode-area">
                    <div class="barcode-placeholder">BARCODE</div>
                    <div class="barcode-number" contenteditable="true">4 895100 801658</div>
                </div>
            </div>

            <div class="contact-info">
                <div class="col"><span>客戶服務</span><span>Customer Service</span><span>hk-cs@cuniq.com</span></div>
                <div class="col"><span>中國香港</span><span>Hong Kong China</span><span>852-2122-1188</span></div>
                <div class="col"><span>中國內地</span><span>Mainland China</span><span>86-186-1881-0010</span></div>
                <div class="col"><span>Whatsapp 查詢</span><span>Whatsapp Enquiry</span><span>852-6361-0010</span></div>
            </div>
            <div class="sim-cutouts">
                 <div class="sim-nano-container"><span>3 in 1 SIM</span></div>
                <div class="sim-main-shape"></div>
            </div>
            <div class="terms-section">
                <div class="final-interpretation">
                  <span>CEPA cerf no: HKSS-0003452-01</span><br>
                  <span>中國聯通(香港)運營有限公司保留最終解釋權</span><br>
                  <span>China Unicom (HK) Operations Ltd. reserves the right of final interpretation</span>
                </div>
                <p contenteditable="true">
                    <b>條款及細則:</b> 此卡由啟用日期起計，有效期5日，不足1日亦以1日計算，均以香港時間00:00至23:59為一日計算。首日以首次使用時間至當日香港時間23:59。到期日為封面所示日數當日之香港時間23:59。提供50GB數據服務，澳洲為4G及5G網絡流動數據服務。此卡不設增值。本產品可於封面所示的地區使用但不可在中國內地激活使用。收費詳情、公平使用政策、條款及細則未能盡錄，請瀏覽www.cuniq.com/global/general/TNC。請保留完整SIM卡卡體作查詢之用。
                </p>
                <p contenteditable="true">
                    <b>Terms & Conditions:</b> The SIM card is valid for 5 days from the date of activation. A day means from 00:00 to 23:59 (Hong Kong time) even if the usage period of that day is less than a day. First day means from the first day of use to the day at 23:59 Hong Kong time. Expiry date means the days shown on the cover at 23:59 Hong Kong time. It provides 50GB mobile data service, 4G & 5G network in Australia. This SIM card is non-rechargeable. This product can be used in the regions shown on the cover but cannot be activated and used in mainland China. Due to limited space, the service charge, Fair Usage Policy, Terms & Conditions cannot be fully listed, please visit www.cuniq.com/global/general/TNC. Please keep the outer part of the SIM card for inquires.
                </p>
            </div>
        </div>
    </div>
    <div class="right-panel">
        <div class="top-section">
            <div class="brand-info">
                <div class="network-badge-placeholder">
                  <div contenteditable="true">5G</div><hr><div contenteditable="true">4G</div>
                </div>
                <div contenteditable="true">中國聯通</div>
            </div>
            <div class="product-title">
                <div contenteditable="true">日本</div>
                <div class="days" contenteditable="true">3日</div>
                <div contenteditable="true">上網卡</div>
            </div>
            <div class="product-subtitle" contenteditable="true">Japan 3-Day Data SIM</div>
            <div class="price" contenteditable="true">HK$88</div>
        </div>
        <div class="main-content">
            <div class="bubble data">
                <div class="main-text" contenteditable="true">5GB</div>
                <div class="subtext" contenteditable="true">高速數據+其後任用<br>High Speed Data+Thereafter unlimited data<br>(minimum 256kbps)</div>
            </div>
            <div class="bubble validity">
                <div class="main-text" contenteditable="true">3日</div>
                <div class="subtext" contenteditable="true">Days Validity</div>
            </div>
        </div>
    </div>
</div>

<script>
    // 存储原始值的对象
    const originalValues = {};

    // 初始化时保存所有可编辑元素的原始值
    document.addEventListener('DOMContentLoaded', function() {
        const editableElements = document.querySelectorAll('[contenteditable="true"]');
        editableElements.forEach((el, index) => {
            // 为每个元素添加唯一的数据属性
            el.setAttribute('data-element-id', index);
            originalValues[el] = el.innerHTML;

            // 监听内容变化
            el.addEventListener('input', function() {
                if (el.innerHTML !== originalValues[el]) {
                    el.classList.add('modified');
                } else {
                    el.classList.remove('modified');
                }
            });
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('export-button').addEventListener('click', async function() {
            try {
                const cardToExport = document.getElementById('card-to-export');
                const styles = document.getElementById('card-styles');

                if (!cardToExport || !styles) {
                    alert('无法找到要导出的内容');
                    return;
                }

                // 让用户自定义文件名
                const defaultFileName = 'sim-card-front-highlighted-' + new Date().toISOString().slice(0,19).replace(/:/g,'-');
                const fileName = prompt('请输入导出文件名（不包含.html后缀）:', defaultFileName);
                
                if (!fileName) {
                    return; // 用户取消了
                }

                // 克隆一份用于导出的节点
                const exportCard = cardToExport.cloneNode(true);

                // 高亮所有修改过的内容
                const modifiedElements = document.querySelectorAll('.modified');
                modifiedElements.forEach(originalEl => {
                    const elementId = originalEl.getAttribute('data-element-id');
                    if (elementId) {
                        const exportEl = exportCard.querySelector(`[data-element-id="${elementId}"]`);
                        if (exportEl) {
                            exportEl.classList.add('highlight-changes');
                        }
                    }
                });

                const cardHTML = exportCard.outerHTML;
                const stylesContent = styles.innerHTML;

                const fullHTML = `<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日本3日上網卡 - 正面（高亮修改版）</title>
    <style>
        ${stylesContent}
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f2f5;
            font-family: var(--font-family);
            margin: 0;
            padding: 40px 20px;
            box-sizing: border-box;
        }

        .print-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .print-button {
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }

        .print-button:hover {
            background-color: #218838;
        }

        .edit-mode-button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .edit-mode-button:hover {
            background-color: #0056b3;
        }

        @media print {
            .print-controls {
                display: none !important;
            }
            body {
                padding: 0;
                background-color: white;
            }
            .card-container {
                box-shadow: none;
            }
        }

        .view-mode [contenteditable="true"] {
            cursor: default;
            pointer-events: none;
        }

        .view-mode [contenteditable="true"]:hover {
            background-color: transparent;
        }

        .view-mode [contenteditable="true"]:focus {
            outline: none;
            box-shadow: none;
            background-color: transparent;
        }

        /* 高亮修改内容的样式 */
        .highlight-changes {
            background-color: #ffeb3b !important;
            border-radius: 2px;
            padding: 1px 3px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="print-controls">
        <button class="print-button" onclick="window.print()">打印</button>
    </div>

    ${cardHTML}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('SIM卡正面设计已加载，修改内容已高亮显示');
        });
    <\/script>
</body>
</html>`;

                // 检查是否支持文件系统访问API
                if ('showSaveFilePicker' in window) {
                    try {
                        // 使用现代文件系统访问API
                        const fileHandle = await window.showSaveFilePicker({
                            suggestedName: fileName + '.html',
                            types: [{
                                description: 'HTML files',
                                accept: {
                                    'text/html': ['.html']
                                }
                            }]
                        });
                        
                        const writable = await fileHandle.createWritable();
                        await writable.write(fullHTML);
                        await writable.close();
                        
                        alert('导出成功！修改内容已用黄色高亮显示');
                        return;
                    } catch (e) {
                        if (e.name !== 'AbortError') {
                            console.error('文件API导出失败:', e);
                        } else {
                            return; // 用户取消了文件选择
                        }
                    }
                }
                
                // 降级到传统下载方式
                const blob = new Blob([fullHTML], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName + '.html';
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                console.log('已导出高亮修改内容的SIM卡正面HTML文件');
                alert('导出成功！修改内容已用黄色高亮显示');

            } catch (error) {
                console.error('导出失败:', error);
                alert('导出失败，请检查控制台错误信息');
            }
        });
    });
</script>

</body>
</html>